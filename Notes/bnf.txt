<start_symbol> :: <block>

<block> :: <stmt>*

<expr> :: <concat> | undef | <bool> | <type> | <name> | <regex> | <hash> |
          <array> | <hash_or_array_access> | <if_else> | <expr> <op> <expr> |
          "!"<expr> | <func_app> | <filter_expr>

<relationship_expr_operand> :: <hash_or_array_access> | <variable> | <if_else> |
                               <order_resource> | <resource_decl> | <filter_expr> |
                               <resource_override>

<stmt> :: <if_else> | <func_app> | <vardef> | <order_resource> |
          <resource_decl> | <filter_expr> | <resource_override> | <class> |
          <definition>

<func_app> :: <name> <expr>*

<expr_or_stmt> :: <expr> | <stmt>

<if_else> :: <expr> <expr_or_stmt>* <expr_or_stmt>*

<vardef> :: <variable> "=" <expr> | <variable> "+=" <expr>
<order_resource> :: <relationship_expr_operand> "to" <relationship_expr_operand>
<resource_decl> :: <attribute>+ | <attribute>+ <resource_decl>
<filter_expr> :: <expr> <filter_op> <expr> 
<resource_override> :: <filter_expr> <attribute_override>+
<attribute_override> :: <name> "=" <expr> | <name> "+=" <expr>
<class> :: string string? (<variable> <expr>?)* <block>
<definition> :: string (<variable> <expr>?)* <block>
<node> :: <hostname>+ <block>

<hostname> :: "default" | <string> | <regex>

<attribute> :: <name> <expr>

<hash> :: (<hash_key> <expr>)+
<array> :: <expr>+ 
<hash_or_array_access> :: <variable> <expr>+
<concat> :: <string> | <string> <expr> <concat>
<hash_key> :: <string> | <concat> | <name>

<string> :: string
<name> :: string
<type> :: string
<variable> :: string
<bool> :: true | false
<regex> :: string

<op> :: "||" | "&&" | ">" | ">=" | "<" | "<=" | "!=" | "=" | "<<" | ">>" |
        "+" | "-" | "/" | "*" | "%" | "~=" | "!~=" | "in"

<filter_op> :: "=" | "!=" | "and" | "or"
